# WebMagic Sites Architecture

## Two Separate Systems for Different Purposes

WebMagic has **two distinct tables** for managing sites, each serving a different purpose in the business workflow.

---

## ğŸ“Š System Overview

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         WEBMAGIC SITES                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   GENERATED SITES (AI)       â”‚    â”‚   CUSTOMER SITES (Sales)     â”‚
â”‚   Table: generated_sites     â”‚    â”‚   Table: sites               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â€¢ AI-generated inventory     â”‚    â”‚ â€¢ Customer-purchased sites   â”‚
â”‚ â€¢ Not yet sold               â”‚    â”‚ â€¢ Active subscriptions       â”‚
â”‚ â€¢ Ready for deployment       â”‚    â”‚ â€¢ Revenue-generating         â”‚
â”‚ â€¢ Status: generating â†’       â”‚    â”‚ â€¢ Status: preview â†’ owned    â”‚
â”‚   completed â†’ published      â”‚    â”‚   â†’ active                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“                                      â†‘
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Purchase Flow â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ¤– Table 1: `generated_sites` - AI Inventory

### Purpose
Stores **AI-generated websites** created by the system but not yet purchased by customers. This is your **inventory** of ready-to-deploy sites.

### Database Schema
```sql
CREATE TABLE generated_sites (
    id UUID PRIMARY KEY,
    business_id UUID REFERENCES businesses(id),
    subdomain VARCHAR(100) UNIQUE NOT NULL,
    custom_domain VARCHAR(255),
    
    -- Content (generated by AI)
    html_content TEXT,  -- Nullable during generation
    css_content TEXT,
    js_content TEXT,
    
    -- AI Metadata
    design_brief JSONB,
    brand_analysis JSONB,
    brand_concept JSONB,
    builder_prompt TEXT,
    
    -- Status tracking
    status VARCHAR(30) DEFAULT 'draft',  -- generating, completed, published, failed
    version INTEGER DEFAULT 1,
    
    -- Timestamps
    created_at TIMESTAMP,
    generation_completed_at TIMESTAMP,
    deployed_at TIMESTAMP,
    sold_at TIMESTAMP
);
```

### Status Flow
```
generating â†’ completed â†’ published â†’ [sold]
    â†“           â†“           â†“
  (AI)      (Ready)    (Live Preview)
```

### Frontend Access
- **Page**: `/sites/generated` 
- **Component**: `GeneratedSitesPage.tsx`
- **API**: `GET /api/v1/sites/` (queries `generated_sites` table)
- **Badge**: "AI" in sidebar

### Use Cases
- View AI generation progress (162 sites currently generating!)
- Monitor generation success/failure rates
- Preview completed sites before offering to customers
- Track inventory of available sites

---

## ğŸ’° Table 2: `sites` - Customer Purchases

### Purpose
Stores **customer-purchased websites** with subscription tracking, payment info, and ownership records. These are **revenue-generating** sites.

### Database Schema
```sql
CREATE TABLE sites (
    id UUID PRIMARY KEY,
    slug VARCHAR(255) UNIQUE NOT NULL,
    business_id UUID REFERENCES businesses(id),
    
    -- Status
    status VARCHAR(50) DEFAULT 'preview',  -- preview, owned, active, suspended, cancelled
    
    -- Purchase tracking
    purchased_at TIMESTAMP,
    purchase_amount NUMERIC(10, 2) DEFAULT 495.00,
    purchase_transaction_id VARCHAR(255),
    
    -- Subscription tracking
    subscription_status VARCHAR(50),  -- active, cancelled, past_due, trialing
    subscription_id VARCHAR(255),
    subscription_started_at TIMESTAMP,
    monthly_amount NUMERIC(10, 2) DEFAULT 99.00,
    next_billing_date DATE,
    
    -- Custom domain
    custom_domain VARCHAR(255) UNIQUE,
    domain_verified BOOLEAN DEFAULT FALSE,
    ssl_provisioned BOOLEAN DEFAULT FALSE,
    
    -- Site metadata
    current_version_id UUID REFERENCES site_versions(id),
    site_title VARCHAR(255),
    site_description TEXT,
    
    -- Timestamps
    created_at TIMESTAMP,
    updated_at TIMESTAMP
);
```

### Status Flow
```
preview â†’ owned â†’ active â†’ [suspended/cancelled]
   â†“        â†“        â†“
(Trial) (Purchased) (Subscription Active)
```

### Frontend Access
- **Page**: `/sites` 
- **Component**: `SitesPage.tsx`
- **API**: `GET /api/v1/admin/sites` (queries `sites` table)
- **Badge**: "Deployed" in sidebar

### Use Cases
- View customer-purchased sites
- Monitor subscription status
- Track revenue from active sites
- Manage custom domains

---

## ğŸ”„ The Purchase Flow

When a customer purchases a site from your inventory:

```
1. Customer views preview of generated_site
   â†“
2. Customer completes purchase ($495 + $99/mo)
   â†“
3. System creates new record in sites table
   â†“
4. generated_sites.sold_at = NOW()
   â†“
5. sites.status = 'owned'
   sites.subscription_status = 'active'
```

---

## ğŸ“ Navigation Structure

### Sidebar Menu
```
Dashboard
Businesses
â”œâ”€ Customer Sites (Deployed) ğŸ’°  â† sites table
â”œâ”€ Generated Sites (AI) ğŸ¤–       â† generated_sites table
Campaigns
Messages
Customers
Coverage
Settings
```

---

## ğŸ¯ Current Status (Your System)

### Generated Sites (AI Inventory)
- **Total**: 162 sites
- **Status**: Currently generating
- **Location**: `generated_sites` table
- **View at**: https://web.lavish.solutions/sites/generated

### Customer Sites (Deployed)
- **Total**: 0 sites (no purchases yet)
- **Location**: `sites` table
- **View at**: https://web.lavish.solutions/sites

---

## ğŸ”‘ Key Differences Summary

| Feature | Generated Sites | Customer Sites |
|---------|----------------|----------------|
| **Purpose** | AI inventory | Customer purchases |
| **Table** | `generated_sites` | `sites` |
| **Status** | generating/completed | preview/owned/active |
| **Revenue** | No (cost center) | Yes (revenue) |
| **Subscription** | N/A | Tracked ($99/mo) |
| **Purchase Info** | N/A | Full tracking |
| **Custom Domain** | No | Yes |
| **API Endpoint** | `/api/v1/sites/` | `/api/v1/admin/sites` |
| **Frontend Route** | `/sites/generated` | `/sites` |

---

## ğŸ“ Important Notes

1. **Never confuse the two tables** - They serve completely different purposes
2. **generated_sites** = Your inventory (what you create)
3. **sites** = Your revenue (what customers buy)
4. The 162 businesses currently being generated will appear in **Generated Sites** page
5. They will NOT appear in **Customer Sites** page until someone purchases them

---

## ğŸš€ Next Steps

1. âœ… Generated Sites page created
2. âœ… Customer Sites page updated
3. âœ… Sidebar navigation updated with badges
4. âœ… API methods separated (`getGeneratedSites()` vs `getSites()`)
5. ğŸ”„ Wait for 162 sites to finish generating
6. ğŸ‘€ View them at `/sites/generated`
7. ğŸ’° Implement purchase flow to move sites from inventory to customer table

---

**Author**: WebMagic Team  
**Date**: February 5, 2026  
**Last Updated**: After implementing separate pages for site types

